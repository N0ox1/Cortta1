// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== USUÁRIOS DO SISTEMA =====
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  country   String?
  role      UserRole @default(BARBERSHOP_ADMIN)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  barbershopId String?
  barbershop   Barbershop? @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  appointments Appointment[] @relation("BarberAppointments")
  createdAppointments Appointment[] @relation("CreatedAppointments")

  @@map("users")
}

enum UserRole {
  SUPER_ADMIN
  BARBERSHOP_ADMIN
  BARBER
  PROFESSIONAL
}

// ===== BARBEARIAS (TENANTS) =====
model Barbershop {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique // URL única da barbearia
  email     String   @unique
  phone     String?
  address   String?
  city      String?
  state     String?
  zipCode   String?
  number    String?
  complement String?
  onlineOnly Boolean @default(false)
  description String?
  website   String?
  logo      String?
  logoImage String? // URL da imagem do logo
  bannerImage String? // URL da imagem do banner
  instagram String?
  whatsapp  String?
  categories Json? // Array de categorias selecionadas
  teamSize  String? // Tamanho da equipe (only-me, 2-5, 6-10, 11-plus)
  
  // Cores personalizáveis da landing page
  primaryColor String? @default("#2563eb")
  secondaryColor String? @default("#1e40af")
  accentColor String? @default("#fbbf24")
  
  // Horário de funcionamento
  workingHours Json? // { weekdays: "08:00 - 18:00", saturday: "08:00 - 17:00", sunday: "Fechado" }
  
  // Status da barbearia
  isActive  Boolean  @default(true)
  isBlocked Boolean  @default(false)
  
  // Configurações de assinatura
  subscriptionPlan     SubscriptionPlan @default(BASIC)
  subscriptionStatus   SubscriptionStatus @default(ACTIVE)
  subscriptionStartDate DateTime?
  subscriptionEndDate   DateTime?
  monthlyFee           Decimal @default(29.90) @db.Decimal(10, 2)
  
  // Métricas
  totalRevenue         Decimal @default(0) @db.Decimal(10, 2)
  monthlyRevenue       Decimal @default(0) @db.Decimal(10, 2)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  users        User[]
  services     Service[]
  clients      Client[]
  appointments Appointment[]
  payments     Payment[]
  joinRequests JoinRequest[]

  @@map("barbershops")
}

enum SubscriptionPlan {
  BASIC
  PREMIUM
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  PENDING
  CANCELLED
}

// ===== SERVIÇOS =====
model Service {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  duration    Int      // duração em minutos
  category    ServiceCategory
  isActive    Boolean  @default(true)
  
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  appointmentServices AppointmentService[]

  @@unique([barbershopId, name])
  @@map("services")
}

enum ServiceCategory {
  CORTE
  BARBA
  COMBO
  OUTROS
}

// ===== CLIENTES =====
model Client {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  birthDate DateTime?
  address   String?
  
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  appointments Appointment[]

  @@unique([barbershopId, email])
  @@map("clients")
}

// ===== AGENDAMENTOS =====
model Appointment {
  id        String   @id @default(cuid())
  date      DateTime
  status    AppointmentStatus @default(SCHEDULED)
  notes     String?
  
  // Relacionamentos
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  
  clientId String
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  barberId String?
  barber   User? @relation("BarberAppointments", fields: [barberId], references: [id])
  
  createdById String
  createdBy   User @relation("CreatedAppointments", fields: [createdById], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  services AppointmentService[]

  @@map("appointments")
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

// ===== SERVIÇOS DO AGENDAMENTO =====
model AppointmentService {
  id            String @id @default(cuid())
  appointmentId String
  serviceId     String
  price         Decimal @db.Decimal(10, 2)
  
  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  service     Service     @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())

  @@unique([appointmentId, serviceId])
  @@map("appointment_services")
}

// ===== PAGAMENTOS =====
model Payment {
  id        String   @id @default(cuid())
  amount    Decimal  @db.Decimal(10, 2)
  status    PaymentStatus @default(PENDING)
  method    PaymentMethod
  dueDate   DateTime
  paidAt    DateTime?
  description String?
  
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  CREDIT_CARD
  PIX
  BANK_TRANSFER
  CASH
}

// ===== CONFIGURAÇÕES DO SISTEMA =====
model SystemConfig {
  id    String @id @default(cuid())
  key   String @unique
  value String
  type  ConfigType @default(STRING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_configs")
}

enum ConfigType {
  STRING
  NUMBER
  BOOLEAN
  JSON
}

// ===== SOLICITAÇÕES DE ACESSO =====
model JoinRequest {
  id        String   @id @default(cuid())
  status    JoinRequestStatus @default(PENDING)
  message   String?
  
  // Dados do usuário que está solicitando
  userEmail     String
  userFirstName String
  userLastName  String
  userPhone     String?
  userCountry   String?
  userPassword  String? // Senha temporária hasheada
  
  // Relacionamentos
  barbershopId String
  barbershop   Barbershop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("join_requests")
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
} 